# nano-banana 画像生成デスクトップアプリ 要件定義書（簡易版 v0.2）

最終更新: 2025-08-31（JST）
作成者: ChatGPT（支援）

---

## 変更履歴

* v0.2（2025-08-31）ユーザー指示に基づき極小スコープへ再編。案Aに確定。編集/非機能/安全/配布/法務/リスクなどの章を削除。
* v0.1（2025-08-31）初版ドラフト。

---

## 1. 目的

Google の最新画像生成モデル **nano-banana（Gemini 2.5 Flash Image）** を **プロンプト入力のみ**で手早く使える **極小デスクトップアプリ**を作る。2時間以内のAI駆動開発で動作するプロトタイプ完成を目標とする。

---

## 2. 前提

* **アーキテクチャ: 案A（直接接続）**

  * アプリがユーザー自身の Gemini API キーで `gemini-2.5-flash-image-preview` を直接呼び出す。
  * バックエンドは作らない。キーはローカル保存（任意）。
* 仕様の確実性に留意し、以下は**概念的記述**にとどめる（詳細パラメータはドキュメント準拠）。
* **対応OS**: **Windows 10/11（x64）** のみ対象。macOS / Linux は対象外。

---

## 3. スコープ

### インスコープ（最小）

* **画像生成のみ**（Text→Image）。
* **4枚同時生成**（1操作で4枚表示）。
* **縦積みバッチ生成**（同一プロンプトで「もっと作る」→さらに4枚を下に追加。合計20枚以上も連打で一気に作成可能）。
* **履歴（最小）**: アプリ起動中セッション内の生成一覧を画面上に保持（アプリ終了で破棄）。

### アウトスコープ（本バージョンでは実装しない）

* 画像編集、マスク、スタイルテンプレ、プリセット。
* クリップボードコピー、D\&D、クイックエクスポート、透過背景保存。
* 非機能要件、安全/法務、配布/運用の詳細設計、リスク対応の記述。

---

## 4. 全体アーキテクチャ（案A）

* フロント（デスクトップ） → Gemini API（HTTPS, APIキー）
* 4並列の画像生成リクエストを **同一プロンプト**で送出し、2×2グリッドで描画。
* 追加生成は同じフローを再実行して下に追加（メモリ保持のみ、永続保存なし）。

---

## 5. 機能要件（最小）

* **プロンプト入力**: 1テキスト欄のみ（テンプレ/プリセット/ネガティブなし）。
* **アスペクト比（UI選択）**: ドロップダウンで `1:1 / 3:4 / 4:3 / 9:16 / 16:9` などを選択。**Gemini 側のハード固定は不可**のため、選択値を**プロンプトに自動挿入**（例: "16:9で").
* **生成**: \*\*［生成］\*\*ボタンで同一プロンプトを4並列→2×2表示。
* **追加生成（バッチ再実行）**: 直近の4枚グリッドの**右下に↻再生成アイコン**。押下で**同一プロンプト**の4枚を**下段に縦積み**。少なくとも5バッチ（=20枚）連続を想定。
* **プロンプト再利用**: 各画像に\*\*［プロンプト再利用］**（またはアイコン）オーバーレイ。クリックで**その画像生成時のプロンプトを上部テキスト欄へ復元\*\*。
* **履歴表示（永続）**: 生成した**全画像を自動保存**し、同時にメタデータ（`prompt`, 生成時刻, モデル, バッチID, AR選択）をローカル JSON に追記。**UIは直近100件を表示**し、最下部に\*\*［もっと見る］\*\*で追加ロード（遅延読み込み）。
* **エラー**: 失敗時に簡易メッセージを表示し、再試行ができる。

---

## 6. 受け入れ条件（最小）

1. 任意のプロンプトと**AR比（UI選択）**を指定し、**［生成］**で**4枚**が表示される。
2. 直近グリッド右下の\*\*↻再生成**押下で**同一プロンプト**の4枚が**下に追加\*\*。\*\*5バッチ（=20枚）\*\*以上でも UI が破綻しない。
3. 生成ごとに**アプリのデータフォルダへ自動保存**（画像＋メタデータJSON）。アプリ再起動後も**履歴が一覧**に表示される。
4. **履歴UIは直近100件まで**表示され、下端の\*\*［もっと見る］\*\*で追加が読み込める。
5. 各画像の\*\*［プロンプト再利用］\*\*で、その画像のプロンプトが上部テキスト欄へ復元される。
6. モデルに `gemini-2.5-flash-image-preview` を使用して動作する。
7. エラー発生時に簡易メッセージが表示され、再試行できる。

---

## 7. UI（必要最低限）

* **1画面構成**

  * 上部: APIキー欄（平文/マスク切替, 任意保存）・**プロンプト入力欄**・\*\*［生成］\*\*ボタン。
  * 中央〜下部: 生成結果の**2×2グリッド**を**バッチ単位**で縦積み。各バッチの**右下に↻（リトライ）**。
  * 各画像カードに\*\*［プロンプト再利用］\*\*オーバーレイ。
* **保存先**: 既定は**Windows のアプリデータフォルダ**直下。

  * Windows: `%LOCALAPPDATA%/nano-banana/outputs/YYYY-MM-DD/`
  * ※ ポータブル配布時は実行ファイル直下の `./outputs/YYYY-MM-DD/` に保存するオプションも用意。

---

## 8. 実装メモ（2時間プロト用・最適化版）

* **スタック**: **Tauri + React（Vite）** 推奨。代替: Electron。
* **SDK**: 公式 **Google GenAI SDK（@google/genai）**。モデル: `gemini-2.5-flash-image-preview`。
* **4枚同時生成**: `Promise.all([...Array(4)].map(() => client.models.generateContent({...})))` で**4並列**。応答の `inlineData.base64` を `Blob→ObjectURL` で描画。
* **アスペクト比**: UIドロップダウン選択値を**プロンプト末尾へ自動付加**（例: "
  出力は16:9の比率で"). パラメータ固定は行わない。
* **バッチリトライ**: 各バッチの `prompt` と `aspect` を保持→↻押下で再実行し、新バッチとして push。
* **保存**: `@tauri-apps/api/path` の `appLocalDataDir()` を用い、**Windows のローカルアプリデータ**配下に `outputs/YYYY-MM-DD/` を作成。画像: `YYYYMMDD_HHMMSS_batch-XX_img-YY.png`。メタJSONは `index.jsonl` に `{ id, prompt, aspect, model, createdAt, files:[...] }` を**1行追記**方式で保存。
* **履歴復元/ページング**: 起動時に `index.jsonl` を**末尾から**読み込み、最新100件を表示。\*\*［もっと見る］\*\*でさらに100件をインクリメンタル読み込み（lazy）。
* **最低限の設定**: 保存先の上書き（アプリデータ配下のみ許容）とポータブル保存の切替。

---

## 9. 既知の制約・注意（概念）

* **アスペクト比**: Gemini Image では**プロンプトで比率を指示**する設計（公式のプロンプトテンプレで比率を入れる旨が明記）。**明示パラメータは未公開**。厳密固定が必要なケースは、**Imagen API** の `aspectRatio`（"1:1", "16:9"等）に切替で対応可能。
* **複数出力**: Gemini Image は 1 プロンプトで**最大10出力**が可能（Vertex ドキュメント）。ただし本要件は**アプリ側4並列**で実現するためプラットフォームに依存しない。

（以上）
